{% load static %}
{% load css_tags %}
{% css_file as css_path %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport"
              content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
        <!-- Mobile Optimization -->
        <meta name="theme-color" content="#3b82f6" id="theme-color-meta">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        <meta name="application-name" content="Scalify">
        <meta name="apple-mobile-web-app-title" content="Scalify">
        <!-- Primary Meta Tags -->
        <title>
            {% block meta_title %}
                Scalify - AI Image Enhancement
            {% endblock meta_title %}
        </title>
        <meta name="title"
              content="{% block meta_title_tag %}Scalify - AI Image Enhancement{% endblock meta_title_tag %}">
        <meta name="description"
              content="{% block meta_description %}Transform your images with AI-powered upscaling, background removal, and image enhancement tools. Try Scalify today.{% endblock meta_description %}">
        <meta name="keywords"
              content="{% block meta_keywords %}image upscaling, AI image enhancement, background removal, image processing, cloudinary{% endblock meta_keywords %}">
        <meta name="author" content="Scalify">
        <meta name="robots"
              content="{% block meta_robots %}index, follow{% endblock meta_robots %}">
        <link rel="canonical"
              href="{% block canonical_url %}{{ request.build_absolute_uri }}{% endblock canonical_url %}">
        <!-- Open Graph / Facebook -->
        <meta property="og:type"
              content="{% block og_type %}website{% endblock og_type %}">
        <meta property="og:url" content="{{ request.build_absolute_uri }}">
        <meta property="og:title"
              content="{% block og_title %}Scalify - AI Image Enhancement{% endblock og_title %}">
        <meta property="og:description"
              content="{% block og_description %}Transform your images with AI-powered upscaling, background removal, and image enhancement tools.{% endblock og_description %}">
        <meta property="og:image"
              content="{% block og_image %}{% static 'images/scalify-social.jpg' %}{% endblock og_image %}">
        <meta property="og:site_name" content="Scalify">
        <meta property="og:locale" content="en_US">
        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="{{ request.build_absolute_uri }}">
        <meta property="twitter:title"
              content="{% block twitter_title %}Scalify - AI Image Enhancement{% endblock twitter_title %}">
        <meta property="twitter:description"
              content="{% block twitter_description %}Transform your images with AI-powered upscaling, background removal, and image enhancement tools.{% endblock twitter_description %}">
        <meta property="twitter:image"
              content="{% block twitter_image %}{% static 'images/scalify-social.jpg' %}{% endblock twitter_image %}">
        <!-- Favicon -->
        <link rel="apple-touch-icon"
              sizes="180x180"
              href="{% static 'favicon/apple-touch-icon.png' %}">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="{% static 'favicon/favicon-32x32.png' %}">
        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="{% static 'favicon/favicon-16x16.png' %}">
        <link rel="manifest" href="{% static 'favicon/site.webmanifest' %}">
        <!-- Styles -->
        <link rel="stylesheet" href="{% static css_path %}">
        <!-- Page-specific SEO - JSON-LD Structured Data -->
        {% block structured_data %}
            <!-- JSON-LD Structured Data for Organization -->
            <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": "Scalify",
            "url": "{{ request.scheme }}://{{ request.get_host }}",
            "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/logo.png' %}",
            "description": "AI-powered image enhancement platform",
            "sameAs": [
                "https://twitter.com/scalify",
                "https://facebook.com/scalify"
            ]
        }
            </script>
            <!-- JSON-LD Structured Data for WebSite -->
            <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "{{ request.scheme }}://{{ request.get_host }}",
            "name": "Scalify",
            "description": "AI-powered image enhancement platform",
            "potentialAction": {
                "@type": "SearchAction",
                "target": "{{ request.scheme }}://{{ request.get_host }}/search?q={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
            </script>
        {% endblock structured_data %}
        {% block extra_meta %}
        {% endblock extra_meta %}
    </head>
    <style>
        /* Form elements styled with Flowbite components */
        input[type="text"], input[type="email"], input[type="password"] {
            @apply w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                   focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                   dark:bg-gray-700 dark:text-gray-100 min-h-[44px] text-sm;
        }
        
        body {
            @apply bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100;
        }
        
        /* Skip to main content link for accessibility */
        .skip-to-content {
            @apply absolute -top-20 left-0 z-50 bg-blue-600 text-white px-4 py-3 transition-all focus:top-0;
        }

        /* Dark mode styles */
        .dark {
            @apply bg-gray-900 text-gray-100;
        }
        
        .dark .bg-white {
            @apply bg-gray-800;
        }
        
        .dark .text-gray-900 {
            @apply text-gray-100;
        }
        
        .dark .text-gray-800 {
            @apply text-gray-100;
        }
        
        .dark .text-gray-700 {
            @apply text-gray-300;
        }
        
        .dark .text-gray-600 {
            @apply text-gray-300;
        }
        
        .dark .text-gray-500 {
            @apply text-gray-400;
        }
        
        .dark .border-gray-200 {
            @apply border-gray-700;
        }
        
        .dark .border-gray-300 {
            @apply border-gray-600;
        }

        .dark .shadow-lg, .dark .shadow-md, .dark .shadow {
            --tw-shadow-color: rgba(0, 0, 0, 0.25);
        }
        
        /* Flowbite form elements focus states */
        .focus\:ring-blue-500:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity));
        }
        
        .dark .focus\:ring-blue-500:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity));
        }
    </style>
    <body class="bg-white dark:bg-gray-900">
        <!-- Accessibility skip navigation -->
        <a href="#main-content" class="skip-to-content">Skip to main content</a>
        {% include "extra/navbar.html" %}
        <main id="main-content" class="min-h-screen">
            {% block body %}
            {% endblock body %}
        </main>
        <footer>
            {% block footer %}
            {% endblock footer %}
        </footer>
        <script src='{% static "js/htmx.min.js" %}'></script>
        <!-- Dark mode script - must come before other scripts -->
        <script>
            // Dark mode handling
            function initTheme() {
                // On page load or when changing themes, best to add inline in `head` to avoid FOUC
                if (localStorage.getItem('color-theme') === 'dark' || 
                    (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-color-meta').setAttribute('content', '#1e3a8a');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('theme-color-meta').setAttribute('content', '#3b82f6');
                }
            }
            
            // Initialize theme immediately
            initTheme();
            
            document.addEventListener('DOMContentLoaded', function() {
                // Set up theme toggle when available
                const themeToggleBtn = document.getElementById('theme-toggle');
                if (themeToggleBtn) {
                    const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
                    const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
                    
                    // Update icons based on current theme
                    if (document.documentElement.classList.contains('dark')) {
                        themeToggleLightIcon.classList.remove('hidden');
                        themeToggleDarkIcon.classList.add('hidden');
                    } else {
                        themeToggleLightIcon.classList.add('hidden');
                        themeToggleDarkIcon.classList.remove('hidden');
                    }
                    
                    // Handle theme toggle button click
                    themeToggleBtn.addEventListener('click', function() {
                        // Toggle icons
                        themeToggleDarkIcon.classList.toggle('hidden');
                        themeToggleLightIcon.classList.toggle('hidden');
                        
                        // Toggle dark mode class and save preference
                        if (document.documentElement.classList.contains('dark')) {
                            document.documentElement.classList.remove('dark');
                            localStorage.setItem('color-theme', 'light');
                            document.getElementById('theme-color-meta').setAttribute('content', '#3b82f6');
                        } else {
                            document.documentElement.classList.add('dark');
                            localStorage.setItem('color-theme', 'dark');
                            document.getElementById('theme-color-meta').setAttribute('content', '#1e3a8a');
                        }
                        
                        // Update navbar appearance if needed
                        const navbar = document.getElementById('navbar');
                        if (navbar && window.scrollY > 10) {
                            navbar.classList.remove('bg-white/95');
                            navbar.classList.remove('bg-gray-900/95');
                            
                            if (document.documentElement.classList.contains('dark')) {
                                navbar.classList.add('bg-gray-900/95');
                            } else {
                                navbar.classList.add('bg-white/95');
                            }
                        }
                    });
                }
                
                // Initialize Flowbite components if needed
                if (typeof initFlowbite === 'function') {
                    initFlowbite();
                }
            });
        </script>
        {% block extra_scripts %}
        {% endblock extra_scripts %}
    </body>
</html>
